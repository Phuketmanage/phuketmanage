<h1>Total client balances</h1>

<% sum = 0 %>
<table class="table table-striped table-sm table-responsive">
  <thead>
    <tr>
      <th width="200px">Name</th>
      <th>Code</th>
      <th>Debit</th>
      <th>Credit</th>
      <th>Balance</th>
    </tr>
  </thead>
  <tbody>
  <% @users.each do |u| %>
    <tr>
      <td><%= "#{u.name} #{u.surname}"%></td>
      <td><%= u.code %></td>
      <td style="text-align: right;"><%= number_to_currency(u.debit_sum, unit:'') %></td>
      <td style="text-align: right;"><%= number_to_currency(u.credit_sum, unit:'') %></td>
      <td style="text-align: right;"><%= number_to_currency(u.balance, unit:'') %></td>
    </tr>
  <% sum += u.balance %>
  <% end %>
  </tbody>
  <tfoot>
    <% total_debit = @users.sum { |u| u.debit_sum.to_d } %>
    <% total_credit = @users.sum { |u| u.credit_sum.to_d } %>
    <% total_balance = @users.sum { |u| u.balance.to_d } %>
    <tr>
      <td colspan=2 style="text-align: right;"><b>Total:</b></td>
      <td style="text-align: right;"><b><%= number_to_currency(total_debit, unit: '') %></b></td>
      <td style="text-align: right;"><b><%= number_to_currency(total_credit, unit: '') %></b></td>
      <td style="text-align: right;"><b><%= number_to_currency(total_balance, unit: '') %></b></td>
    </tr>
  </tfoot>
</table>