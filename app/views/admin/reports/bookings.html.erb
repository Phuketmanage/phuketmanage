<h1>Bookings</h1>
<%= form_with(url: report_bookings_path, method: :get, local: true) do |f| %>
  <div class="form-row">
    <div class="col-6 col-lg-2 mb-1 mb-lg-0">
      <%= date_field_tag :from, {}, value: @from, class: "form-control" %>
    </div>
    <div class="col-6 col-lg-2 mb-1 mb-lg-0">
      <%= date_field_tag :to, {}, value: @to, class: "form-control mb-2 mr-md-2" %>
    </div>
    <div class="col col-lg-2">
      <% options = options_for_select([['All', '']] + @houses.map{ |h| ["#{h.code}", h.id] }, @house_id) %>
      <%= f.select :house_id,
            options,
                      {}, { class: "form-control"} %>
    </div>

    <%= submit_tag t('show'), class: "btn btn-primary mb-2 mr-2" %>
  </div>
<% end %>


<div>
  <% if @details %>
    <div class="bg-white">
      <table class="table">
        <tr>
          <th>Source</th>
          <th>Bookings qty</th>
          <th>Sale, THB</th>
          <th>Agent, THB</th>
          <th>Comm, THB</th>
          <th>Owner, THB</th>
        </tr>
        <% @details.each do |source| %>
          <tr>
            <td><%= @sources[source.source_id] %></td>
            <td><%= source.source_count %> (<%= (source.source_count.to_d/@totals.qty*100).round %>%)</td>
            <td><%= number_to_currency(source.sale_sum, precision: 0, unit: '') if !source.sale_sum.nil? %></td>
            <td><%= number_to_currency(source.agent_sum, precision: 0, unit: '') if !source.agent_sum.nil? %> (<%= (source.agent_sum.to_d/source.sale_sum*100).round %>%)</td>
            <td><%= number_to_currency(source.comm_sum, precision: 0, unit: '') if !source.comm_sum.nil? %> (<%= (source.comm_sum.to_d/source.sale_sum*100).round %>%)</td>
            <td><%= number_to_currency(source.nett_sum, precision: 0, unit: '') if !source.nett_sum.nil? %></td>
          </tr>
        <% end %>
        <tr style="font-weight:bold">
          <td>Total:</td>
          <td><%= @totals.qty %></td>
          <td><%= number_to_currency(@totals.sale_sum, precision: 0, unit: '') if !@totals.sale_sum.nil? %></td>
          <td><%= number_to_currency(@totals.agent_sum, precision: 0, unit: '') if !@totals.agent_sum.nil? %> (<%= (@totals.agent_sum.to_d/@totals.sale_sum*100).round %>%) if !@totals.agent_sum.nil?</td>
          <td><%= number_to_currency(@totals.comm_sum, precision: 0, unit: '') if !@totals.comm_sum.nil? %> (<%= (@totals.comm_sum.to_d/@totals.sale_sum*100).round %>%) if !@totals.comm_sum.nil?</td>
          <td><%= number_to_currency(@totals.nett_sum, precision: 0, unit: '') if !@totals.nett_sum.nil? %></td></tr>
      </table>
    </div>
    Statistic showen for all bookings with statuses temporary, pending, confirmed, paid, changing exclude bookings with statuses canceled and block.
  <% else %>
    <div class="bg-white p-3">
      No bookings for this period
    </div>
  <% end %>
</div>
