<% if bookings.empty? %>
  <div class="alert alert-warning" role="alert">
    No bookings
  </div>
<% else %>
  <table class="table table-striped table-bordered table-sm table-responsive-lg bg-white">
    <thead>
      <tr>
        <% if !@one_house %>
          <th width="60px"><%= t('house') %></th>
        <% end %>
        <th width="120px"><%= t('start') %></th>
        <th width="120px"><%= t('finish') %></th>
        <th width="60px"><%= t('days') %></th>
        <th width="120px" class='text-right'><%= t('profit') %></th>
        <th width="120px" class='text-right'><%= t('to_balance') %></th>
        <th><%= t('comment') %></th>
      </tr>
    </thead>
    <tbody>
      <% nett_sum = 0 %>
      <% profit_sum = 0 %>
      <% @bookings.each do |booking| %>
        <% profit = 0 %>
        <% if booking.transactions.any? %>
          <% income = booking.transactions.joins(:balance_outs).sum(:debit) %>
          <% comm = booking.transactions.joins(:balance_outs).sum(:credit) %>
          <% profit = income - comm %>
        <% end %>
        <% nett_sum += booking.nett %>
        <% profit_sum += profit %>
        <tr class="booking_row" data-booking-no="<%= booking.number %>">
          <% if !@one_house %>
            <td><%= !@house ? link_to(booking.house.code, bookings_front_path(hid: booking.house.id)) : booking.house.code %></td>
          <% end %>
          <td><%= booking.start.to_fs(:date) %></td>
          <td><%= booking.finish.to_fs(:date) %></td>
          <td><%= (booking.finish - booking.start).to_i %></td>
          <td class='text-right'><%= number_to_currency(booking.nett, precision: 0, unit: '') %></td>
          <td class='text-right'><%= number_to_currency(profit, precision: 0, unit: '') %></td>
          <td>
            <%= booking.comment_owner %>
            <% if booking.transactions.any? %>
              <%= '|' if booking.comment_owner %>
              <%= t('added_to_balance') %>: <%= booking.transactions.order(:date).map{|t| "#{t.date.to_fs(:date)}"}.join ', ' %>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
    <tfoot>
      <tr>
        <% if !@one_house %>
          <td></td>
        <% end %>
        <td></td>
        <td></td>
        <td class='font-weight-bold text-right'><%= t('total') %>:</td>
        <td class='font-weight-bold text-right'><%= number_to_currency(nett_sum, precision: 0, unit: '') %></td>
        <td class='font-weight-bold text-right'><%= number_to_currency(profit_sum, precision: 0, unit: '') %></td>
        <td class='font-weight-bold'><%= number_to_currency(nett_sum - profit_sum, precision: 0, unit: '') %></td>
      </tr>
    </tfoot>
  </table>
<% end %>
