<%= form_with(model: booking, local: true, data: {controller: "booking"}) do |form| %>
  <%= render 'shared/error_messages', object: form.object %>
  <div class="row">
    <div class="col-md-2 form-group">
      <%= form.select :house_id, @houses, { prompt: 'Select house' }, { class: "form-control", data: { "booking-target": "houseField", "action": "input->booking#updateFpicker", dates: [123] } } %>
    </div>
    <div class="col-md-4 form-group">
      <%= form.text_field :period,
          class: 'border pl-2 fp-input',
          readonly: true,
          autocomplete: 'off',
          placeholder: t('search.dates'),
          data: {
                  controller: "flatpickr",
                  flatpickr_locale: I18n.locale,
                  flatpickr_now: Date.current.iso8601,
                  flatpickr_min_date: (Date.current + 1.day).iso8601,
                  flatpickr_disable: nil,
                  action: "trigger-update@window->flatpickr#update_attr", 
                  },
                value: booking.get_period %>
    </div>
    <div class="col-md-2 form-group">
      <% if controller.action_name == 'new' %>
        <%= form.select :status, ['pending', 'block'], {}, { class: "form-control"} %>
      <% else %>
        <%= form.select :status, ['pending','confirmed', 'paid', 'block', 'canceled'], {}, { class: "form-control" } %>
      <% end %>
    </div>
    <div class="col-md-2 form-group">
      <%= form.select :source_id, Source.all.map {|s| [s.name, s.id]}, { include_blank: 'Our booking' }, { class: "form-control" } %>
    </div>
  </div>
  <div class='row'>
    <div class="col-md-6 form-group">
      <%= form.label :client_details %>
      <%= form.text_field :client_details, placeholder: 'Name Surname, pax, phone, email', class: 'form-control' %>
    </div>
  </div>
  <% if controller.action_name == 'new' %>
    <div class="row">
      <div class="col">
        <div class="form-check">
          <%= form.check_box :manual_price, { class: 'form-check-input', id: 'manual_price_check_box' } %>
          <%= form.label "Manual initial price", { class: 'form-check-label',for: 'manual_price_check_box' } %>
        </div>
      </div>
    </div>
  <% end %>
  <div class="row">
    <div class="col-md-3 form-group">
      <%= form.label :sale %>
      <%= form.number_field :sale, class: 'form-control calcs', data: { "booking-target": "saleField", "action": "input->booking#updatePercentage" }, min: 0 %>
      <small class="ml-1 text-secondary">Origial: <%= @booking_original.sale if !@booking_original.nil? %></small>
    </div>
    <div class="col-md-3 form-group">
      <%= form.label :agent %>
      <span class="ml-1 badge bg-primary text-white" data-booking-target="agentPercentage">0%</span>
      <%= form.number_field :agent, class: 'form-control calcs', data: { "booking-target": "agentField", "action": "input->booking#updatePercentage"}, min: 0 %>
    </div>
    <div class="col-md-3 form-group">
      <%= form.label :comm %>
      <span class="ml-1 badge bg-primary text-white" data-booking-target="commPercentage">0%</span>
      <i class="bi bi-lightning-charge text-secondary dropdown-toggle float-right" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></i>
      <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
        <%= link_to "20% to company, 0% to agent", '#', class: "dropdown-item", data: { "action": "click->booking#calculateTwentyPercent:prevent" } %>
        <%= link_to "25% to company, 0% to agent", '#', class: "dropdown-item", data: { "action": "click->booking#calculateTwentyFivePercent:prevent" } %>
        <%= link_to "10% to company, 10% to agent", '#', class: "dropdown-item", data: { "action": "click->booking#calculateTenPercentToCompanyTenPercentToAgent:prevent" } %>
        <%= link_to "15% to company, 10% to agent", '#', class: "dropdown-item", data: { "action": "click->booking#calculateFifteenPercentToCompanyTenPercentToAgent:prevent" } %>
      </div>
      <%= form.number_field :comm, class: 'form-control calcs', data: { "booking-target": "commField", "action": "input->booking#updatePercentage"}, min: 0 %>
      <small class="ml-1 text-secondary">Origial: <%= @booking_original.comm if !@booking_original.nil? %></small><br />
    </div>
    <div class="col-md-3 form-group">
      <%= form.label :nett %>
      <span class="ml-1 badge bg-primary text-white" data-booking-target="nettPercentage">0%</span>
      <%= form.number_field :nett, class: 'form-control calcs', data: { "booking-target": "nettField", "action": "input->booking#updatePercentage"}, min: 0 %>
      <small class="ml-1 text-secondary">Origial: <%= @booking_original.nett if !@booking_original.nil? %></small>
    </div>
  </div>
  <div class="row">
    <div class="col form-group">
      <%= form.label 'Comment inner (owner will not see)' %>
      <%= form.text_area :comment, class: 'form-control', rows: 2 %>
    </div>
  </div>
  <div class="row">
    <div class="col form-group">
      <%= form.label 'Comment for owner' %>
      <%= form.text_area :comment_owner, class: 'form-control', rows: 2 %>
    </div>
  </div>
  <div class="row">
    <div class="col form-group">
      <%= form.label 'Comment for guest relation' %>
      <%= form.text_area :comment_gr, class: 'form-control', rows: 2 %>
    </div>
  </div>
  <div class="row">
    <div class="col-md-2 form-group">
      <%= form.label 'Check in date if other from booking start' %>
      <%= form.date_field :check_in, class: 'form-control calcs' %>
    </div>
    <div class="col-md-2 form-group">
      <%= form.label 'Check out date if other from booking finish' %>
      <%= form.date_field :check_out, class: 'form-control calcs' %>
    </div>
  </div>
  <div class="form-check form-check-inline">
    <%= form.check_box :allotment, { class: 'form-check-input', id: 'unavailable_check_box' } %>
    <%= form.label :allotment, { class: 'form-check-label', for: 'unavailable_check_box' } %>
  </div>
  <div class="form-check form-check-inline">
    <%= form.check_box :no_check_in, { class: 'form-check-input', id: 'no_check_in_check_box' } %>
    <%= form.label :no_check_in, { class: 'form-check-label', for: 'no_check_in_check_box' } %>
  </div>
  <div class="form-check form-check-inline">
    <%= form.check_box :no_check_out, { class: 'form-check-input', id: 'no_check_out_check_box' } %>
    <%= form.label :no_check_out, { class: 'form-check-label', for: 'no_check_out_check_box' } %>
  </div>
  <% if current_user.role?('Admin') %>
    <div class="form-check form-check-inline">
      <%= form.check_box :ignore_warnings, { class: 'form-check-input', id: 'ignore_warnings_check_box' } %>
      <%= form.label :ignore_warnings, { class: 'form-check-label', for: 'ignore_warnings_check_box' } %>
    </div>
  <% end %>
  <div  class='mt-3'>
    <%= form.submit 'Save booking', class: 'btn btn-primary' %>
    <% if @booking.house %>
      <%= link_to 'Back', admin_house_bookings_path(@booking.house.id), class: 'btn btn-secondary' %>
    <% else %>
      <%= link_to 'Back', bookings_path, class: 'btn btn-secondary' %>
    <% end %>
  </div>
<% end %>
