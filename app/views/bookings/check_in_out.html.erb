<h1>Check in/out</h1>

<%= form_with(url: bookings_check_in_out_path, local: true, method: :get) do |f| %>
  <div class="form-row">
    <div class="col-lg-2 form-group">
      <%= date_field_tag :from, {}, value: params[:from], class: "form-control" %>
    </div>
    <div class="col-lg-2 form-group">
      <%= date_field_tag :to, {}, value: params[:to], class: "form-control" %>
    </div>
    <div class="col-lg-3 form-group">
      <%= f.submit 'Show', class: 'btn btn-primary' %>
      <%= link_to 'Drop filter', bookings_check_in_out_path, class: 'btn btn-secondary'  %>
    </div>
  </div>
<% end %>


<div class="d-none d-lg-block mb-2 p-2 ">
  <div class="row font-weight-bold">
    <div class="col-lg-2">
      Date/Type
    </div>
    <div class="col-lg-1">
      House
    </div>
    <div class="col-lg-5">
      Client
    </div>
    <div class="col-lg-4">
      Our transfer
    </div>
  </div>
</div>
<% date = '' %>
<% @result.each do |r| %>
  <%#= "#{date} != #{r[:date]}"  %>
  <% if date != r[:date] %>
    <% css = 'font-weight-bold' %>
    <% date = r[:date] %>
  <% end %>

  <div class="row shadow-sm mb-2 p-1 bg-light rounded">
    <div class="col">
      <div class="row">
        <div class="col-lg-2">
          <span class="<%= css %>"><%=  "#{r[:date]} #{r[:type]}" %></span>
        </div>
        <div class="col-lg-1">
          <span class="d-lg-none">House: </span>
          <%=  r[:house] %>
        </div>
        <div class="col-lg-5">
          <span class="d-lg-none">Client: </span>
          <%=  r[:client] %>
        </div>
        <div class="col-lg-4">
          <span class="d-lg-none">Our transfer: </span>
          <% r[:transfers].each do |t| %>
            <%= t %><br />
          <% end %>
        </div>
      </div>
      <% booking = Booking.find(r[:booking_id]) %>
      <% if r[:type] == "IN" %>
        <div class="row">
          <div class="col">
              Period: <%= " #{booking.start.strftime('%d.%m.%Y')} -
                            #{booking.finish.strftime('%d.%m.%Y')}" %><br />
              Price: <%= booking.sale %><br />
              Source: <%= booking.source.name %>
          </div>
        </div>
      <% end %>
      <div class="row">
        <div class="col">

            <%=  "Comment: #{r[:comment]}" %>
            <%= link_to "Edit comment", '', class: 'edit_comment',
                                            data: { booking_id: r[:booking_id] } %>
            <%= form_with model: booking,
                          url: update_booking_comment_gr_path(r[:booking_id]),
                          local: true,
                          class: 'form_edit_comment_gr d-none',
                          data: { booking_id: r[:booking_id] } do |f| %>
              <div class="form-group">
                <%= f.text_field :comment_gr, class: "form-control", rows: 1 %>
              </div>
              <div class="form-group text-right">
                <%= f.submit "Save", class: 'btn btn-primary' %>
                <%= link_to "Cancel", '#',
                      class: 'btn btn-secondary cancel_edit_comment',
                      data: { booking_id: r[:booking_id] }
                 %>
              </div>
            <% end %>
        </div>
      </div>
    </div>
  </div>
<% end %>
